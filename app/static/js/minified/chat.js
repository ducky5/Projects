document.onreadystatechange=function(){if("complete"===document.readyState){let e=io();e.on("connect",function(t){e.emit("send_latest_msg_to_client",document.getElementById("send-text").getAttribute("RECIPIENT_ID"))}),e.on("get_latest_msg",function(e){let t='<div class="recipient-pronoun">'+e.recipient_pronoun+'</div><div class="recipient-message">'+e.message+"</div>";document.getElementById("recipient_msg_from_websocket").innerHTML=t}),chat_scrollable=document.getElementById("scrollable-chat"),chat_scrollable.scrollTo(0,chat_scrollable.scrollHeight),document.getElementById("send-text").addEventListener("click",function(){let e=new XMLHttpRequest,t={recipient_id:this.getAttribute("RECIPIENT_ID"),message:document.getElementById("text-to-send").value};e.onload=function(){if(200==this.status&&"success"==this.responseText){document.getElementById("text-to-send").value="";let e='<div class="sender-pronoun">You</div><div class="sender-message">'+t.message+"</div>";document.getElementById("current_user_msg_from_client_js").innerHTML=e,chat_scrollable.scrollTo(0,chat_scrollable.scrollHeight)}},e.open("POST","/save-message",!0),e.setRequestHeader("Content-Type","application/json"),e.send(JSON.stringify(t))}),document.getElementById("text-to-send").onkeypress=function(e){if(13==e.keyCode){e.preventDefault();let t=new XMLHttpRequest,n={recipient_id:document.getElementById("send-text").getAttribute("RECIPIENT_ID"),message:document.getElementById("text-to-send").value};t.onload=function(){if(200==this.status&&"success"==this.responseText){document.getElementById("text-to-send").value="";let e='<div class="sender-pronoun">You</div><div class="sender-message">'+n.message+"</div>";document.getElementById("current_user_msg_from_client_js").innerHTML=e,chat_scrollable.scrollTo(0,chat_scrollable.scrollHeight)}},t.open("POST","/save-message",!0),t.setRequestHeader("Content-Type","application/json"),t.send(JSON.stringify(n))}}}};
